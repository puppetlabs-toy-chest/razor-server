#!Powershell
<% require 'shellwords' %>
$chocolateyps1 = "C:\Chocolatey\chocolateyinstall\chocolatey.ps1"
$installvalue = Invoke-Expression "$chocolateyps1 install puppet"

<% unless broker.empty? %>
write-host "Configure Puppet"
# Now, configuration.  Much as I love the idea of editing an ini file with
# basic Unix tools like sed and awk, this seems much less worse, even if it
# puts a puppet module you might not expect into place on disk.
puppet module install puppetlabs/inifile

# Update the ini file with the resource tool.
<% broker.each do |setting, value| %>
puppet resource ini_setting ensure=present path=C:/ProgramData/PuppetLabs/puppet/etc/puppet.conf section=main setting=<%= setting.shellescape %> value=<%= value.shellescape %>
<% end %>

<% else %>
write-host
<% end %>

