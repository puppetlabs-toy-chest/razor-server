#!ipxe
echo Razor <%= installer.label %> model boot_call
echo Installation node: <%= node_url  %>
echo Installation repo: <%= repo_url %>

echo ======================================================================
echo freeing all loaded images to ensure wimboot works
imgfree
echo ======================================================================

sleep 3
kernel <%= file_url('wimboot', true) %> || goto error
initrd <%= repo_url("/bootmgr") %> bootmgr || goto error
initrd <%= repo_url("/boot/bcd") %> BCD || goto error
initrd <%= repo_url("/boot/fonts/segmono_boot.ttf") %> segmono_boot.ttf || goto error
initrd <%= repo_url("/boot/fonts/segoe_slboot.ttf") %> segoe_slboot.ttf || goto error
initrd <%= repo_url("/boot/fonts/wgl4_boot.ttf") %> wgl4_boot.ttf || goto error
initrd <%= repo_url("/boot/boot.sdi") %> boot.sdi || goto error
initrd <%= repo_url("/sources/boot.wim") %> boot.wim || goto error

echo ======================================================================
imgstat
echo now booting WinPE client
boot

:error
prompt --key s --timeout 60 ERROR, hit 's' for the iPXE shell; reboot in 60 seconds && shell || reboot
